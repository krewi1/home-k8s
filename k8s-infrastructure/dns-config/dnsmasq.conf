# dnsmasq configuration for Kubernetes cluster DNS
# Place this at: /etc/dnsmasq.conf

# Never forward plain names (without a dot or domain part)
domain-needed

# Never forward addresses in the non-routed address spaces
bogus-priv

# Don't read /etc/resolv.conf for upstream servers
# We'll specify them explicitly below
no-resolv

# Upstream DNS servers
# Use Google DNS and Cloudflare DNS for external queries
server=8.8.8.8
server=8.8.4.4
server=1.1.1.1

# Local domain
local=/home/
domain=home

# Add the domain to simple names in /etc/hosts
expand-hosts

# Listen on all interfaces
# If you want to restrict, specify interface or listen-address
interface=eth0
listen-address=127.0.0.1,192.168.0.221

# Bind to interfaces to avoid conflicts
bind-interfaces

# Set the size of dnsmasq's cache
# Default is 150, increase for better performance
cache-size=10000

# Log queries for debugging (comment out in production for performance)
log-queries

# Log to this file (comment out to use syslog)
# log-facility=/var/log/dnsmasq.log

# Don't poll /etc/resolv.conf for changes
no-poll

# Read additional configuration from this directory
conf-dir=/etc/dnsmasq.d/,*.conf

# Add local-only domains
# These will never be forwarded to upstream servers
local=/home/

# Set TTL for responses
# Lower TTL for internal services allows faster updates
local-ttl=60

# Enable DNSSEC validation (optional, adds security)
# dnssec

# Negative caching: cache "no such domain" responses
# Reduces load on upstream servers
# neg-ttl=3600

# Maximum number of concurrent DNS queries
dns-forward-max=150

# Don't read /etc/hosts
# We use a separate file for cluster hosts
no-hosts

# Specify alternate hosts file
addn-hosts=/etc/hosts.home

# DHCP settings (if you want dnsmasq to also serve DHCP)
# Uncomment and configure if needed
# dhcp-range=192.168.1.50,192.168.1.150,12h
# dhcp-option=option:router,192.168.1.1
# dhcp-option=option:dns-server,<pi4-ip>

# Prevent DNS rebinding attacks
stop-dns-rebind

# Allow queries from private IP ranges
rebind-localhost-ok

# Uncomment to enable TFTP server (for PXE boot, etc.)
# enable-tftp
# tftp-root=/var/ftpd

# Misc options
# filterwin2k - filters useless Windows 2000 DNS requests
filterwin2k

# Return SERVFAIL instead of using upstream for invalid domains
# domain-needed

# Don't forward reverse lookups for private IP ranges
bogus-priv

# Add host records for the nginx/DNS server itself
# Replace <pi4-ip> with actual IP
# address=/dns.home/<pi4-ip>
